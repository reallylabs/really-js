/*!
 *  Really.js v0.0.1
 *  Copyright (C) 2014-2015 Really Inc. <http://really.io>
 *
 *  Date:  Thu Dec 25 2014 13:54:13
 */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.Really=t()}}(function(){var t;return function n(t,e,r){function o(u,a){if(!e[u]){if(!t[u]){var c="function"==typeof require&&require;if(!a&&c)return c(u,!0);if(i)return i(u,!0);var s=new Error("Cannot find module '"+u+"'");throw s.code="MODULE_NOT_FOUND",s}var f=e[u]={exports:{}};t[u][0].call(f.exports,function(n){var e=t[u][1][n];return o(e?e:n)},f,f.exports,n,t,e,r)}return e[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(t,n){function e(){}var r=n.exports={};r.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,n="undefined"!=typeof window&&window.MutationObserver,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};var r=[];if(n){var o=document.createElement("div"),i=new MutationObserver(function(){var t=r.slice();r.length=0,t.forEach(function(t){t()})});return i.observe(o,{attributes:!0}),function(t){r.length||o.setAttribute("yes","no"),r.push(t)}}return e?(window.addEventListener("message",function(t){var n=t.source;if((n===window||null===n)&&"process-tick"===t.data&&(t.stopPropagation(),r.length>0)){var e=r.shift();e()}},!0),function(t){r.push(t),window.postMessage("process-tick","*")}):function(t){setTimeout(t,0)}}(),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.on=e,r.addListener=e,r.once=e,r.off=e,r.removeListener=e,r.removeAllListeners=e,r.emit=e,r.binding=function(){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(){throw new Error("process.chdir is not supported")}},{}],2:[function(t,n){function e(t){return t?r(t):void 0}function r(t){for(var n in e.prototype)t[n]=e.prototype[n];return t}n.exports=e,e.prototype.on=e.prototype.addEventListener=function(t,n){return this._callbacks=this._callbacks||{},(this._callbacks[t]=this._callbacks[t]||[]).push(n),this},e.prototype.once=function(t,n){function e(){r.off(t,e),n.apply(this,arguments)}var r=this;return this._callbacks=this._callbacks||{},e.fn=n,this.on(t,e),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(t,n){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var e=this._callbacks[t];if(!e)return this;if(1==arguments.length)return delete this._callbacks[t],this;for(var r,o=0;o<e.length;o++)if(r=e[o],r===n||r.fn===n){e.splice(o,1);break}return this},e.prototype.emit=function(t){this._callbacks=this._callbacks||{};var n=[].slice.call(arguments,1),e=this._callbacks[t];if(e){e=e.slice(0);for(var r=0,o=e.length;o>r;++r)e[r].apply(this,n)}return this},e.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks[t]||[]},e.prototype.hasListeners=function(t){return!!this.listeners(t).length}},{}],3:[function(n,e,r){(function(n){(function(){function o(t,n,e){for(var r=(e||0)-1,o=t?t.length:0;++r<o;)if(t[r]===n)return r;return-1}function i(t,n){var e=typeof n;if(t=t.cache,"boolean"==e||null==n)return t[n]?0:-1;"number"!=e&&"string"!=e&&(e="object");var r="number"==e?n:k+n;return t=(t=t[e])&&t[r],"object"==e?t&&o(t,n)>-1?0:-1:t?0:-1}function u(t){var n=this.cache,e=typeof t;if("boolean"==e||null==t)n[t]=!0;else{"number"!=e&&"string"!=e&&(e="object");var r="number"==e?t:k+t,o=n[e]||(n[e]={});"object"==e?(o[r]||(o[r]=[])).push(t):o[r]=!0}}function a(t){return t.charCodeAt(0)}function c(t,n){for(var e=t.criteria,r=n.criteria,o=-1,i=e.length;++o<i;){var u=e[o],a=r[o];if(u!==a){if(u>a||"undefined"==typeof u)return 1;if(a>u||"undefined"==typeof a)return-1}}return t.index-n.index}function s(t){var n=-1,e=t.length,r=t[0],o=t[e/2|0],i=t[e-1];if(r&&"object"==typeof r&&o&&"object"==typeof o&&i&&"object"==typeof i)return!1;var a=p();a["false"]=a["null"]=a["true"]=a.undefined=!1;var c=p();for(c.array=t,c.cache=a,c.push=u;++n<e;)c.push(t[n]);return c}function f(t){return"\\"+G[t]}function l(){return g.pop()||[]}function p(){return b.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function h(t){t.length=0,g.length<j&&g.push(t)}function d(t){var n=t.cache;n&&d(n),t.array=t.cache=t.criteria=t.object=t.number=t.string=t.value=null,b.length<j&&b.push(t)}function v(t,n,e){n||(n=0),"undefined"==typeof e&&(e=t?t.length:0);for(var r=-1,o=e-n||0,i=Array(0>o?0:o);++r<o;)i[r]=t[n+r];return i}function y(t){function n(t){return t&&"object"==typeof t&&!Xr(t)&&Dr.call(t,"__wrapped__")?t:new e(t)}function e(t,n){this.__chain__=!!n,this.__wrapped__=t}function r(t){function n(){if(r){var t=v(r);Ir.apply(t,arguments)}if(this instanceof n){var i=g(e.prototype),u=e.apply(i,t||arguments);return Nn(u)?u:i}return e.apply(o,t||arguments)}var e=t[0],r=t[2],o=t[4];return Gr(n,t),n}function u(t,n,e,r,o){if(e){var i=e(t);if("undefined"!=typeof i)return i}var a=Nn(t);if(!a)return t;var c=Or.call(t);if(!V[c])return t;var s=Jr[c];switch(c){case q:case Y:return new s(+t);case U:case H:return new s(t);case W:return i=s(t.source,E.exec(t)),i.lastIndex=t.lastIndex,i}var f=Xr(t);if(n){var p=!r;r||(r=l()),o||(o=l());for(var d=r.length;d--;)if(r[d]==t)return o[d];i=f?s(t.length):{}}else i=f?v(t):io({},t);return f&&(Dr.call(t,"index")&&(i.index=t.index),Dr.call(t,"input")&&(i.input=t.input)),n?(r.push(t),o.push(i),(f?Gn:co)(t,function(t,a){i[a]=u(t,n,e,r,o)}),p&&(h(r),h(o)),i):i}function g(t){return Nn(t)?qr(t):{}}function b(t,n,e){if("function"!=typeof t)return Xe;if("undefined"==typeof n||!("prototype"in t))return t;var r=t.__bindData__;if("undefined"==typeof r&&(Kr.funcNames&&(r=!t.name),r=r||!Kr.funcDecomp,!r)){var o=Ar.call(t);Kr.funcNames||(r=!R.test(o)),r||(r=D.test(o),Gr(t,r))}if(r===!1||r!==!0&&1&r[1])return t;switch(e){case 1:return function(e){return t.call(n,e)};case 2:return function(e,r){return t.call(n,e,r)};case 3:return function(e,r,o){return t.call(n,e,r,o)};case 4:return function(e,r,o,i){return t.call(n,e,r,o,i)}}return Ie(t,n)}function j(t){function n(){var t=c?u:this;if(o){var h=v(o);Ir.apply(h,arguments)}if((i||f)&&(h||(h=v(arguments)),i&&Ir.apply(h,i),f&&h.length<a))return r|=16,j([e,l?r:-4&r,h,null,u,a]);if(h||(h=arguments),s&&(e=t[p]),this instanceof n){t=g(e.prototype);var d=e.apply(t,h);return Nn(d)?d:t}return e.apply(t,h)}var e=t[0],r=t[1],o=t[2],i=t[3],u=t[4],a=t[5],c=1&r,s=2&r,f=4&r,l=8&r,p=e;return Gr(n,t),n}function G(t,n){var e=-1,r=sn(),u=t?t.length:0,a=u>=_&&r===o,c=[];if(a){var f=s(n);f?(r=i,n=f):a=!1}for(;++e<u;){var l=t[e];r(n,l)<0&&c.push(l)}return a&&d(n),c}function Z(t,n,e,r){for(var o=(r||0)-1,i=t?t.length:0,u=[];++o<i;){var a=t[o];if(a&&"object"==typeof a&&"number"==typeof a.length&&(Xr(a)||hn(a))){n||(a=Z(a,n,e));var c=-1,s=a.length,f=u.length;for(u.length+=s;++c<s;)u[f++]=a[c]}else e||u.push(a)}return u}function tn(t,n,e,r,o,i){if(e){var u=e(t,n);if("undefined"!=typeof u)return!!u}if(t===n)return 0!==t||1/t==1/n;var a=typeof t,c=typeof n;if(!(t!==t||t&&K[a]||n&&K[c]))return!1;if(null==t||null==n)return t===n;var s=Or.call(t),f=Or.call(n);if(s==L&&(s=$),f==L&&(f=$),s!=f)return!1;switch(s){case q:case Y:return+t==+n;case U:return t!=+t?n!=+n:0==t?1/t==1/n:t==+n;case W:case H:return t==_r(n)}var p=s==P;if(!p){var d=Dr.call(t,"__wrapped__"),v=Dr.call(n,"__wrapped__");if(d||v)return tn(d?t.__wrapped__:t,v?n.__wrapped__:n,e,r,o,i);if(s!=$)return!1;var y=t.constructor,m=n.constructor;if(y!=m&&!(Rn(y)&&y instanceof y&&Rn(m)&&m instanceof m)&&"constructor"in t&&"constructor"in n)return!1}var g=!o;o||(o=l()),i||(i=l());for(var b=o.length;b--;)if(o[b]==t)return i[b]==n;var w=0;if(u=!0,o.push(t),i.push(n),p){if(b=t.length,w=n.length,u=w==b,u||r)for(;w--;){var k=b,_=n[w];if(r)for(;k--&&!(u=tn(t[k],_,e,r,o,i)););else if(!(u=tn(t[w],_,e,r,o,i)))break}}else ao(n,function(n,a,c){return Dr.call(c,a)?(w++,u=Dr.call(t,a)&&tn(t[a],n,e,r,o,i)):void 0}),u&&!r&&ao(t,function(t,n,e){return Dr.call(e,n)?u=--w>-1:void 0});return o.pop(),i.pop(),g&&(h(o),h(i)),u}function nn(t,n,e,r,o){(Xr(n)?Gn:co)(n,function(n,i){var u,a,c=n,s=t[i];if(n&&((a=Xr(n))||so(n))){for(var f=r.length;f--;)if(u=r[f]==n){s=o[f];break}if(!u){var l;e&&(c=e(s,n),(l="undefined"!=typeof c)&&(s=c)),l||(s=a?Xr(s)?s:[]:so(s)?s:{}),r.push(n),o.push(s),l||nn(s,n,e,r,o)}}else e&&(c=e(s,n),"undefined"==typeof c&&(c=n)),"undefined"!=typeof c&&(s=c);t[i]=s})}function en(t,n){return t+Nr(Qr()*(n-t+1))}function on(t,n,e){var r=-1,u=sn(),a=t?t.length:0,c=[],f=!n&&a>=_&&u===o,p=e||f?l():c;if(f){var v=s(p);u=i,p=v}for(;++r<a;){var y=t[r],m=e?e(y,r,t):y;(n?!r||p[p.length-1]!==m:u(p,m)<0)&&((e||f)&&p.push(m),c.push(y))}return f?(h(p.array),d(p)):e&&h(p),c}function un(t){return function(e,r,o){var i={};r=n.createCallback(r,o,3);var u=-1,a=e?e.length:0;if("number"==typeof a)for(;++u<a;){var c=e[u];t(i,c,r(c,u,e),e)}else co(e,function(n,e,o){t(i,n,r(n,e,o),o)});return i}}function an(t,n,e,o,i,u){var a=1&n,c=2&n,s=4&n,f=16&n,l=32&n;if(!c&&!Rn(t))throw new jr;f&&!e.length&&(n&=-17,f=e=!1),l&&!o.length&&(n&=-33,l=o=!1);var p=t&&t.__bindData__;if(p&&p!==!0)return p=v(p),p[2]&&(p[2]=v(p[2])),p[3]&&(p[3]=v(p[3])),!a||1&p[1]||(p[4]=i),!a&&1&p[1]&&(n|=8),!s||4&p[1]||(p[5]=u),f&&Ir.apply(p[2]||(p[2]=[]),e),l&&Lr.apply(p[3]||(p[3]=[]),o),p[1]|=n,an.apply(null,p);var h=1==n||17===n?r:j;return h([t,n,e,o,i,u])}function cn(t){return no[t]}function sn(){var t=(t=n.indexOf)===ge?o:t;return t}function fn(t){return"function"==typeof t&&Cr.test(t)}function ln(t){var n,e;return t&&Or.call(t)==$&&(n=t.constructor,!Rn(n)||n instanceof n)?(ao(t,function(t,n){e=n}),"undefined"==typeof e||Dr.call(t,e)):!1}function pn(t){return eo[t]}function hn(t){return t&&"object"==typeof t&&"number"==typeof t.length&&Or.call(t)==L||!1}function dn(t,n,e,r){return"boolean"!=typeof n&&null!=n&&(r=e,e=n,n=!1),u(t,n,"function"==typeof e&&b(e,r,1))}function vn(t,n,e){return u(t,!0,"function"==typeof n&&b(n,e,1))}function yn(t,n){var e=g(t);return n?io(e,n):e}function mn(t,e,r){var o;return e=n.createCallback(e,r,3),co(t,function(t,n,r){return e(t,n,r)?(o=n,!1):void 0}),o}function gn(t,e,r){var o;return e=n.createCallback(e,r,3),wn(t,function(t,n,r){return e(t,n,r)?(o=n,!1):void 0}),o}function bn(t,n,e){var r=[];ao(t,function(t,n){r.push(n,t)});var o=r.length;for(n=b(n,e,3);o--&&n(r[o--],r[o],t)!==!1;);return t}function wn(t,n,e){var r=to(t),o=r.length;for(n=b(n,e,3);o--;){var i=r[o];if(n(t[i],i,t)===!1)break}return t}function kn(t){var n=[];return ao(t,function(t,e){Rn(t)&&n.push(e)}),n.sort()}function _n(t,n){return t?Dr.call(t,n):!1}function jn(t){for(var n=-1,e=to(t),r=e.length,o={};++n<r;){var i=e[n];o[t[i]]=i}return o}function xn(t){return t===!0||t===!1||t&&"object"==typeof t&&Or.call(t)==q||!1}function Sn(t){return t&&"object"==typeof t&&Or.call(t)==Y||!1}function Tn(t){return t&&1===t.nodeType||!1}function On(t){var n=!0;if(!t)return n;var e=Or.call(t),r=t.length;return e==P||e==H||e==L||e==$&&"number"==typeof r&&Rn(t.splice)?!r:(co(t,function(){return n=!1}),n)}function Cn(t,n,e,r){return tn(t,n,"function"==typeof e&&b(e,r,2))}function En(t){return Fr(t)&&!Ur(parseFloat(t))}function Rn(t){return"function"==typeof t}function Nn(t){return!(!t||!K[typeof t])}function An(t){return Dn(t)&&t!=+t}function Mn(t){return null===t}function Dn(t){return"number"==typeof t||t&&"object"==typeof t&&Or.call(t)==U||!1}function In(t){return t&&"object"==typeof t&&Or.call(t)==W||!1}function zn(t){return"string"==typeof t||t&&"object"==typeof t&&Or.call(t)==H||!1}function Bn(t){return"undefined"==typeof t}function Ln(t,e,r){var o={};return e=n.createCallback(e,r,3),co(t,function(t,n,r){o[n]=e(t,n,r)}),o}function Pn(t){var n=arguments,e=2;if(!Nn(t))return t;if("number"!=typeof n[2]&&(e=n.length),e>3&&"function"==typeof n[e-2])var r=b(n[--e-1],n[e--],2);else e>2&&"function"==typeof n[e-1]&&(r=n[--e]);for(var o=v(arguments,1,e),i=-1,u=l(),a=l();++i<e;)nn(t,o[i],r,u,a);return h(u),h(a),t}function qn(t,e,r){var o={};if("function"!=typeof e){var i=[];ao(t,function(t,n){i.push(n)}),i=G(i,Z(arguments,!0,!1,1));for(var u=-1,a=i.length;++u<a;){var c=i[u];o[c]=t[c]}}else e=n.createCallback(e,r,3),ao(t,function(t,n,r){e(t,n,r)||(o[n]=t)});return o}function Yn(t){for(var n=-1,e=to(t),r=e.length,o=dr(r);++n<r;){var i=e[n];o[n]=[i,t[i]]}return o}function Fn(t,e,r){var o={};if("function"!=typeof e)for(var i=-1,u=Z(arguments,!0,!1,1),a=Nn(t)?u.length:0;++i<a;){var c=u[i];c in t&&(o[c]=t[c])}else e=n.createCallback(e,r,3),ao(t,function(t,n,r){e(t,n,r)&&(o[n]=t)});return o}function Un(t,e,r,o){var i=Xr(t);if(null==r)if(i)r=[];else{var u=t&&t.constructor,a=u&&u.prototype;r=g(a)}return e&&(e=n.createCallback(e,o,4),(i?Gn:co)(t,function(t,n,o){return e(r,t,n,o)})),r}function $n(t){for(var n=-1,e=to(t),r=e.length,o=dr(r);++n<r;)o[n]=t[e[n]];return o}function Wn(t){for(var n=arguments,e=-1,r=Z(n,!0,!1,1),o=n[2]&&n[2][n[1]]===t?1:r.length,i=dr(o);++e<o;)i[e]=t[r[e]];return i}function Hn(t,n,e){var r=-1,o=sn(),i=t?t.length:0,u=!1;return e=(0>e?Wr(0,i+e):e)||0,Xr(t)?u=o(t,n,e)>-1:"number"==typeof i?u=(zn(t)?t.indexOf(n,e):o(t,n,e))>-1:co(t,function(t){return++r>=e?!(u=t===n):void 0}),u}function Vn(t,e,r){var o=!0;e=n.createCallback(e,r,3);var i=-1,u=t?t.length:0;if("number"==typeof u)for(;++i<u&&(o=!!e(t[i],i,t)););else co(t,function(t,n,r){return o=!!e(t,n,r)});return o}function Qn(t,e,r){var o=[];e=n.createCallback(e,r,3);var i=-1,u=t?t.length:0;if("number"==typeof u)for(;++i<u;){var a=t[i];e(a,i,t)&&o.push(a)}else co(t,function(t,n,r){e(t,n,r)&&o.push(t)});return o}function Jn(t,e,r){e=n.createCallback(e,r,3);var o=-1,i=t?t.length:0;if("number"!=typeof i){var u;return co(t,function(t,n,r){return e(t,n,r)?(u=t,!1):void 0}),u}for(;++o<i;){var a=t[o];if(e(a,o,t))return a}}function Kn(t,e,r){var o;return e=n.createCallback(e,r,3),Xn(t,function(t,n,r){return e(t,n,r)?(o=t,!1):void 0}),o}function Gn(t,n,e){var r=-1,o=t?t.length:0;if(n=n&&"undefined"==typeof e?n:b(n,e,3),"number"==typeof o)for(;++r<o&&n(t[r],r,t)!==!1;);else co(t,n);return t}function Xn(t,n,e){var r=t?t.length:0;if(n=n&&"undefined"==typeof e?n:b(n,e,3),"number"==typeof r)for(;r--&&n(t[r],r,t)!==!1;);else{var o=to(t);r=o.length,co(t,function(t,e,i){return e=o?o[--r]:--r,n(i[e],e,i)})}return t}function Zn(t,n){var e=v(arguments,2),r=-1,o="function"==typeof n,i=t?t.length:0,u=dr("number"==typeof i?i:0);return Gn(t,function(t){u[++r]=(o?n:t[n]).apply(t,e)}),u}function te(t,e,r){var o=-1,i=t?t.length:0;if(e=n.createCallback(e,r,3),"number"==typeof i)for(var u=dr(i);++o<i;)u[o]=e(t[o],o,t);else u=[],co(t,function(t,n,r){u[++o]=e(t,n,r)});return u}function ne(t,e,r){var o=-1/0,i=o;if("function"!=typeof e&&r&&r[e]===t&&(e=null),null==e&&Xr(t))for(var u=-1,c=t.length;++u<c;){var s=t[u];s>i&&(i=s)}else e=null==e&&zn(t)?a:n.createCallback(e,r,3),Gn(t,function(t,n,r){var u=e(t,n,r);u>o&&(o=u,i=t)});return i}function ee(t,e,r){var o=1/0,i=o;if("function"!=typeof e&&r&&r[e]===t&&(e=null),null==e&&Xr(t))for(var u=-1,c=t.length;++u<c;){var s=t[u];i>s&&(i=s)}else e=null==e&&zn(t)?a:n.createCallback(e,r,3),Gn(t,function(t,n,r){var u=e(t,n,r);o>u&&(o=u,i=t)});return i}function re(t,e,r,o){if(!t)return r;var i=arguments.length<3;e=n.createCallback(e,o,4);var u=-1,a=t.length;if("number"==typeof a)for(i&&(r=t[++u]);++u<a;)r=e(r,t[u],u,t);else co(t,function(t,n,o){r=i?(i=!1,t):e(r,t,n,o)});return r}function oe(t,e,r,o){var i=arguments.length<3;return e=n.createCallback(e,o,4),Xn(t,function(t,n,o){r=i?(i=!1,t):e(r,t,n,o)}),r}function ie(t,e,r){return e=n.createCallback(e,r,3),Qn(t,function(t,n,r){return!e(t,n,r)})}function ue(t,n,e){if(t&&"number"!=typeof t.length&&(t=$n(t)),null==n||e)return t?t[en(0,t.length-1)]:m;var r=ae(t);return r.length=Hr(Wr(0,n),r.length),r}function ae(t){var n=-1,e=t?t.length:0,r=dr("number"==typeof e?e:0);return Gn(t,function(t){var e=en(0,++n);r[n]=r[e],r[e]=t}),r}function ce(t){var n=t?t.length:0;return"number"==typeof n?n:to(t).length}function se(t,e,r){var o;e=n.createCallback(e,r,3);var i=-1,u=t?t.length:0;if("number"==typeof u)for(;++i<u&&!(o=e(t[i],i,t)););else co(t,function(t,n,r){return!(o=e(t,n,r))});return!!o}function fe(t,e,r){var o=-1,i=Xr(e),u=t?t.length:0,a=dr("number"==typeof u?u:0);for(i||(e=n.createCallback(e,r,3)),Gn(t,function(t,n,r){var u=a[++o]=p();i?u.criteria=te(e,function(n){return t[n]}):(u.criteria=l())[0]=e(t,n,r),u.index=o,u.value=t}),u=a.length,a.sort(c);u--;){var s=a[u];a[u]=s.value,i||h(s.criteria),d(s)}return a}function le(t){return t&&"number"==typeof t.length?v(t):$n(t)}function pe(t){for(var n=-1,e=t?t.length:0,r=[];++n<e;){var o=t[n];o&&r.push(o)}return r}function he(t){return G(t,Z(arguments,!0,!0,1))}function de(t,e,r){var o=-1,i=t?t.length:0;for(e=n.createCallback(e,r,3);++o<i;)if(e(t[o],o,t))return o;return-1}function ve(t,e,r){var o=t?t.length:0;for(e=n.createCallback(e,r,3);o--;)if(e(t[o],o,t))return o;return-1}function ye(t,e,r){var o=0,i=t?t.length:0;if("number"!=typeof e&&null!=e){var u=-1;for(e=n.createCallback(e,r,3);++u<i&&e(t[u],u,t);)o++}else if(o=e,null==o||r)return t?t[0]:m;return v(t,0,Hr(Wr(0,o),i))}function me(t,n,e,r){return"boolean"!=typeof n&&null!=n&&(r=e,e="function"!=typeof n&&r&&r[n]===t?null:n,n=!1),null!=e&&(t=te(t,e,r)),Z(t,n)}function ge(t,n,e){if("number"==typeof e){var r=t?t.length:0;e=0>e?Wr(0,r+e):e||0}else if(e){var i=Oe(t,n);return t[i]===n?i:-1}return o(t,n,e)}function be(t,e,r){var o=0,i=t?t.length:0;if("number"!=typeof e&&null!=e){var u=i;for(e=n.createCallback(e,r,3);u--&&e(t[u],u,t);)o++}else o=null==e||r?1:e||o;return v(t,0,Hr(Wr(0,i-o),i))}function we(){for(var t=[],n=-1,e=arguments.length,r=l(),u=sn(),a=u===o,c=l();++n<e;){var f=arguments[n];(Xr(f)||hn(f))&&(t.push(f),r.push(a&&f.length>=_&&s(n?t[n]:c)))}var p=t[0],v=-1,y=p?p.length:0,m=[];t:for(;++v<y;){var g=r[0];if(f=p[v],(g?i(g,f):u(c,f))<0){for(n=e,(g||c).push(f);--n;)if(g=r[n],(g?i(g,f):u(t[n],f))<0)continue t;m.push(f)}}for(;e--;)g=r[e],g&&d(g);return h(r),h(c),m}function ke(t,e,r){var o=0,i=t?t.length:0;if("number"!=typeof e&&null!=e){var u=i;for(e=n.createCallback(e,r,3);u--&&e(t[u],u,t);)o++}else if(o=e,null==o||r)return t?t[i-1]:m;return v(t,Wr(0,i-o))}function _e(t,n,e){var r=t?t.length:0;for("number"==typeof e&&(r=(0>e?Wr(0,r+e):Hr(e,r-1))+1);r--;)if(t[r]===n)return r;return-1}function je(t){for(var n=arguments,e=0,r=n.length,o=t?t.length:0;++e<r;)for(var i=-1,u=n[e];++i<o;)t[i]===u&&(Br.call(t,i--,1),o--);return t}function xe(t,n,e){t=+t||0,e="number"==typeof e?e:+e||1,null==n&&(n=t,t=0);for(var r=-1,o=Wr(0,Er((n-t)/(e||1))),i=dr(o);++r<o;)i[r]=t,t+=e;return i}function Se(t,e,r){var o=-1,i=t?t.length:0,u=[];for(e=n.createCallback(e,r,3);++o<i;){var a=t[o];e(a,o,t)&&(u.push(a),Br.call(t,o--,1),i--)}return u}function Te(t,e,r){if("number"!=typeof e&&null!=e){var o=0,i=-1,u=t?t.length:0;for(e=n.createCallback(e,r,3);++i<u&&e(t[i],i,t);)o++}else o=null==e||r?1:Wr(0,e);return v(t,o)}function Oe(t,e,r,o){var i=0,u=t?t.length:i;for(r=r?n.createCallback(r,o,1):Xe,e=r(e);u>i;){var a=i+u>>>1;r(t[a])<e?i=a+1:u=a}return i}function Ce(){return on(Z(arguments,!0,!0))}function Ee(t,e,r,o){return"boolean"!=typeof e&&null!=e&&(o=r,r="function"!=typeof e&&o&&o[e]===t?null:e,e=!1),null!=r&&(r=n.createCallback(r,o,3)),on(t,e,r)}function Re(t){return G(t,v(arguments,1))}function Ne(){for(var t=-1,n=arguments.length;++t<n;){var e=arguments[t];if(Xr(e)||hn(e))var r=r?on(G(r,e).concat(G(e,r))):e}return r||[]}function Ae(){for(var t=arguments.length>1?arguments:arguments[0],n=-1,e=t?ne(ho(t,"length")):0,r=dr(0>e?0:e);++n<e;)r[n]=ho(t,n);return r}function Me(t,n){var e=-1,r=t?t.length:0,o={};for(n||!r||Xr(t[0])||(n=[]);++e<r;){var i=t[e];n?o[i]=n[e]:i&&(o[i[0]]=i[1])}return o}function De(t,n){if(!Rn(n))throw new jr;return function(){return--t<1?n.apply(this,arguments):void 0}}function Ie(t,n){return arguments.length>2?an(t,17,v(arguments,2),null,n):an(t,1,null,null,n)}function ze(t){for(var n=arguments.length>1?Z(arguments,!0,!1,1):kn(t),e=-1,r=n.length;++e<r;){var o=n[e];t[o]=an(t[o],1,null,null,t)}return t}function Be(t,n){return arguments.length>2?an(n,19,v(arguments,2),null,t):an(n,3,null,null,t)}function Le(){for(var t=arguments,n=t.length;n--;)if(!Rn(t[n]))throw new jr;return function(){for(var n=arguments,e=t.length;e--;)n=[t[e].apply(this,n)];return n[0]}}function Pe(t,n){return n="number"==typeof n?n:+n||t.length,an(t,4,null,null,null,n)}function qe(t,n,e){var r,o,i,u,a,c,s,f=0,l=!1,p=!0;if(!Rn(t))throw new jr;if(n=Wr(0,n)||0,e===!0){var h=!0;p=!1}else Nn(e)&&(h=e.leading,l="maxWait"in e&&(Wr(n,e.maxWait)||0),p="trailing"in e?e.trailing:p);var d=function(){var e=n-(yo()-u);if(0>=e){o&&Rr(o);var l=s;o=c=s=m,l&&(f=yo(),i=t.apply(a,r),c||o||(r=a=null))}else c=zr(d,e)},v=function(){c&&Rr(c),o=c=s=m,(p||l!==n)&&(f=yo(),i=t.apply(a,r),c||o||(r=a=null))};return function(){if(r=arguments,u=yo(),a=this,s=p&&(c||!h),l===!1)var e=h&&!c;else{o||h||(f=u);var y=l-(u-f),m=0>=y;m?(o&&(o=Rr(o)),f=u,i=t.apply(a,r)):o||(o=zr(v,y))}return m&&c?c=Rr(c):c||n===l||(c=zr(d,n)),e&&(m=!0,i=t.apply(a,r)),!m||c||o||(r=a=null),i}}function Ye(t){if(!Rn(t))throw new jr;var n=v(arguments,1);return zr(function(){t.apply(m,n)},1)}function Fe(t,n){if(!Rn(t))throw new jr;var e=v(arguments,2);return zr(function(){t.apply(m,e)},n)}function Ue(t,n){if(!Rn(t))throw new jr;var e=function(){var r=e.cache,o=n?n.apply(this,arguments):k+arguments[0];return Dr.call(r,o)?r[o]:r[o]=t.apply(this,arguments)};return e.cache={},e}function $e(t){var n,e;if(!Rn(t))throw new jr;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}}function We(t){return an(t,16,v(arguments,1))}function He(t){return an(t,32,null,v(arguments,1))}function Ve(t,n,e){var r=!0,o=!0;if(!Rn(t))throw new jr;return e===!1?r=!1:Nn(e)&&(r="leading"in e?e.leading:r,o="trailing"in e?e.trailing:o),Q.leading=r,Q.maxWait=n,Q.trailing=o,qe(t,n,Q)}function Qe(t,n){return an(n,16,[t])}function Je(t){return function(){return t}}function Ke(t,n,e){var r=typeof t;if(null==t||"function"==r)return b(t,n,e);if("object"!=r)return er(t);var o=to(t),i=o[0],u=t[i];return 1!=o.length||u!==u||Nn(u)?function(n){for(var e=o.length,r=!1;e--&&(r=tn(n[o[e]],t[o[e]],null,!0)););return r}:function(t){var n=t[i];return u===n&&(0!==u||1/u==1/n)}}function Ge(t){return null==t?"":_r(t).replace(oo,cn)}function Xe(t){return t}function Ze(t,r,o){var i=!0,u=r&&kn(r);r&&(o||u.length)||(null==o&&(o=r),a=e,r=t,t=n,u=kn(r)),o===!1?i=!1:Nn(o)&&"chain"in o&&(i=o.chain);var a=t,c=Rn(a);Gn(u,function(n){var e=t[n]=r[n];c&&(a.prototype[n]=function(){var n=this.__chain__,r=this.__wrapped__,o=[r];Ir.apply(o,arguments);var u=e.apply(t,o);if(i||n){if(r===u&&Nn(u))return this;u=new a(u),u.__chain__=n}return u})})}function tr(){return t._=Tr,this}function nr(){}function er(t){return function(n){return n[t]}}function rr(t,n,e){var r=null==t,o=null==n;if(null==e&&("boolean"==typeof t&&o?(e=t,t=1):o||"boolean"!=typeof n||(e=n,o=!0)),r&&o&&(n=1),t=+t||0,o?(n=t,t=0):n=+n||0,e||t%1||n%1){var i=Qr();return Hr(t+i*(n-t+parseFloat("1e-"+((i+"").length-1))),n)}return en(t,n)}function or(t,n){if(t){var e=t[n];return Rn(e)?t[n]():e}}function ir(t,e,r){var o=n.templateSettings;t=_r(t||""),r=uo({},r,o);var i,u=uo({},r.imports,o.imports),a=to(u),c=$n(u),s=0,l=r.interpolate||M,p="__p += '",h=kr((r.escape||M).source+"|"+l.source+"|"+(l===N?C:M).source+"|"+(r.evaluate||M).source+"|$","g");t.replace(h,function(n,e,r,o,u,a){return r||(r=o),p+=t.slice(s,a).replace(I,f),e&&(p+="' +\n__e("+e+") +\n'"),u&&(i=!0,p+="';\n"+u+";\n__p += '"),r&&(p+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),s=a+n.length,n}),p+="';\n";var d=r.variable,v=d;v||(d="obj",p="with ("+d+") {\n"+p+"\n}\n"),p=(i?p.replace(S,""):p).replace(T,"$1").replace(O,"$1;"),p="function("+d+") {\n"+(v?"":d+" || ("+d+" = {});\n")+"var __t, __p = '', __e = _.escape"+(i?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var y="\n/*\n//# sourceURL="+(r.sourceURL||"/lodash/template/source["+B++ +"]")+"\n*/";try{var g=mr(a,"return "+p+y).apply(m,c)}catch(b){throw b.source=p,b}return e?g(e):(g.source=p,g)}function ur(t,n,e){t=(t=+t)>-1?t:0;var r=-1,o=dr(t);for(n=b(n,e,1);++r<t;)o[r]=n(r);return o}function ar(t){return null==t?"":_r(t).replace(ro,pn)}function cr(t){var n=++w;return _r(null==t?"":t)+n}function sr(t){return t=new e(t),t.__chain__=!0,t}function fr(t,n){return n(t),t}function lr(){return this.__chain__=!0,this}function pr(){return _r(this.__wrapped__)}function hr(){return this.__wrapped__}t=t?rn.defaults(X.Object(),t,rn.pick(X,z)):X;var dr=t.Array,vr=t.Boolean,yr=t.Date,mr=t.Function,gr=t.Math,br=t.Number,wr=t.Object,kr=t.RegExp,_r=t.String,jr=t.TypeError,xr=[],Sr=wr.prototype,Tr=t._,Or=Sr.toString,Cr=kr("^"+_r(Or).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Er=gr.ceil,Rr=t.clearTimeout,Nr=gr.floor,Ar=mr.prototype.toString,Mr=fn(Mr=wr.getPrototypeOf)&&Mr,Dr=Sr.hasOwnProperty,Ir=xr.push,zr=t.setTimeout,Br=xr.splice,Lr=xr.unshift,Pr=function(){try{var t={},n=fn(n=wr.defineProperty)&&n,e=n(t,t,t)&&n}catch(r){}return e}(),qr=fn(qr=wr.create)&&qr,Yr=fn(Yr=dr.isArray)&&Yr,Fr=t.isFinite,Ur=t.isNaN,$r=fn($r=wr.keys)&&$r,Wr=gr.max,Hr=gr.min,Vr=t.parseInt,Qr=gr.random,Jr={};Jr[P]=dr,Jr[q]=vr,Jr[Y]=yr,Jr[F]=mr,Jr[$]=wr,Jr[U]=br,Jr[W]=kr,Jr[H]=_r,e.prototype=n.prototype;var Kr=n.support={};Kr.funcDecomp=!fn(t.WinRTError)&&D.test(y),Kr.funcNames="string"==typeof mr.name,n.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:N,variable:"",imports:{_:n}},qr||(g=function(){function n(){}return function(e){if(Nn(e)){n.prototype=e;var r=new n;n.prototype=null}return r||t.Object()}}());var Gr=Pr?function(t,n){J.value=n,Pr(t,"__bindData__",J)}:nr,Xr=Yr||function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&Or.call(t)==P||!1},Zr=function(t){var n,e=t,r=[];if(!e)return r;if(!K[typeof t])return r;for(n in e)Dr.call(e,n)&&r.push(n);return r},to=$r?function(t){return Nn(t)?$r(t):[]}:Zr,no={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},eo=jn(no),ro=kr("("+to(eo).join("|")+")","g"),oo=kr("["+to(no).join("")+"]","g"),io=function(t,n,e){var r,o=t,i=o;if(!o)return i;var u=arguments,a=0,c="number"==typeof e?2:u.length;if(c>3&&"function"==typeof u[c-2])var s=b(u[--c-1],u[c--],2);else c>2&&"function"==typeof u[c-1]&&(s=u[--c]);for(;++a<c;)if(o=u[a],o&&K[typeof o])for(var f=-1,l=K[typeof o]&&to(o),p=l?l.length:0;++f<p;)r=l[f],i[r]=s?s(i[r],o[r]):o[r];return i},uo=function(t,n,e){var r,o=t,i=o;if(!o)return i;for(var u=arguments,a=0,c="number"==typeof e?2:u.length;++a<c;)if(o=u[a],o&&K[typeof o])for(var s=-1,f=K[typeof o]&&to(o),l=f?f.length:0;++s<l;)r=f[s],"undefined"==typeof i[r]&&(i[r]=o[r]);return i},ao=function(t,n,e){var r,o=t,i=o;if(!o)return i;if(!K[typeof o])return i;n=n&&"undefined"==typeof e?n:b(n,e,3);for(r in o)if(n(o[r],r,t)===!1)return i;return i},co=function(t,n,e){var r,o=t,i=o;if(!o)return i;if(!K[typeof o])return i;n=n&&"undefined"==typeof e?n:b(n,e,3);for(var u=-1,a=K[typeof o]&&to(o),c=a?a.length:0;++u<c;)if(r=a[u],n(o[r],r,t)===!1)return i;return i},so=Mr?function(t){if(!t||Or.call(t)!=$)return!1;var n=t.valueOf,e=fn(n)&&(e=Mr(n))&&Mr(e);return e?t==e||Mr(t)==e:ln(t)}:ln,fo=un(function(t,n,e){Dr.call(t,e)?t[e]++:t[e]=1}),lo=un(function(t,n,e){(Dr.call(t,e)?t[e]:t[e]=[]).push(n)}),po=un(function(t,n,e){t[e]=n}),ho=te,vo=Qn,yo=fn(yo=yr.now)&&yo||function(){return(new yr).getTime()},mo=8==Vr(x+"08")?Vr:function(t,n){return Vr(zn(t)?t.replace(A,""):t,n||0)};return n.after=De,n.assign=io,n.at=Wn,n.bind=Ie,n.bindAll=ze,n.bindKey=Be,n.chain=sr,n.compact=pe,n.compose=Le,n.constant=Je,n.countBy=fo,n.create=yn,n.createCallback=Ke,n.curry=Pe,n.debounce=qe,n.defaults=uo,n.defer=Ye,n.delay=Fe,n.difference=he,n.filter=Qn,n.flatten=me,n.forEach=Gn,n.forEachRight=Xn,n.forIn=ao,n.forInRight=bn,n.forOwn=co,n.forOwnRight=wn,n.functions=kn,n.groupBy=lo,n.indexBy=po,n.initial=be,n.intersection=we,n.invert=jn,n.invoke=Zn,n.keys=to,n.map=te,n.mapValues=Ln,n.max=ne,n.memoize=Ue,n.merge=Pn,n.min=ee,n.omit=qn,n.once=$e,n.pairs=Yn,n.partial=We,n.partialRight=He,n.pick=Fn,n.pluck=ho,n.property=er,n.pull=je,n.range=xe,n.reject=ie,n.remove=Se,n.rest=Te,n.shuffle=ae,n.sortBy=fe,n.tap=fr,n.throttle=Ve,n.times=ur,n.toArray=le,n.transform=Un,n.union=Ce,n.uniq=Ee,n.values=$n,n.where=vo,n.without=Re,n.wrap=Qe,n.xor=Ne,n.zip=Ae,n.zipObject=Me,n.collect=te,n.drop=Te,n.each=Gn,n.eachRight=Xn,n.extend=io,n.methods=kn,n.object=Me,n.select=Qn,n.tail=Te,n.unique=Ee,n.unzip=Ae,Ze(n),n.clone=dn,n.cloneDeep=vn,n.contains=Hn,n.escape=Ge,n.every=Vn,n.find=Jn,n.findIndex=de,n.findKey=mn,n.findLast=Kn,n.findLastIndex=ve,n.findLastKey=gn,n.has=_n,n.identity=Xe,n.indexOf=ge,n.isArguments=hn,n.isArray=Xr,n.isBoolean=xn,n.isDate=Sn,n.isElement=Tn,n.isEmpty=On,n.isEqual=Cn,n.isFinite=En,n.isFunction=Rn,n.isNaN=An,n.isNull=Mn,n.isNumber=Dn,n.isObject=Nn,n.isPlainObject=so,n.isRegExp=In,n.isString=zn,n.isUndefined=Bn,n.lastIndexOf=_e,n.mixin=Ze,n.noConflict=tr,n.noop=nr,n.now=yo,n.parseInt=mo,n.random=rr,n.reduce=re,n.reduceRight=oe,n.result=or,n.runInContext=y,n.size=ce,n.some=se,n.sortedIndex=Oe,n.template=ir,n.unescape=ar,n.uniqueId=cr,n.all=Vn,n.any=se,n.detect=Jn,n.findWhere=Jn,n.foldl=re,n.foldr=oe,n.include=Hn,n.inject=re,Ze(function(){var t={};return co(n,function(e,r){n.prototype[r]||(t[r]=e)}),t}(),!1),n.first=ye,n.last=ke,n.sample=ue,n.take=ye,n.head=ye,co(n,function(t,r){var o="sample"!==r;n.prototype[r]||(n.prototype[r]=function(n,r){var i=this.__chain__,u=t(this.__wrapped__,n,r);return i||null!=n&&(!r||o&&"function"==typeof n)?new e(u,i):u})}),n.VERSION="2.4.1",n.prototype.chain=lr,n.prototype.toString=pr,n.prototype.value=hr,n.prototype.valueOf=hr,Gn(["join","pop","shift"],function(t){var r=xr[t];n.prototype[t]=function(){var t=this.__chain__,n=r.apply(this.__wrapped__,arguments);return t?new e(n,t):n}}),Gn(["push","reverse","sort","unshift"],function(t){var e=xr[t];n.prototype[t]=function(){return e.apply(this.__wrapped__,arguments),this}}),Gn(["concat","slice","splice"],function(t){var r=xr[t];n.prototype[t]=function(){return new e(r.apply(this.__wrapped__,arguments),this.__chain__)}}),n}var m,g=[],b=[],w=0,k=+new Date+"",_=75,j=40,x=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",S=/\b__p \+= '';/g,T=/\b(__p \+=) '' \+/g,O=/(__e\(.*?\)|\b__t\)) \+\n'';/g,C=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,E=/\w*$/,R=/^\s*function[ \n\r\t]+\w/,N=/<%=([\s\S]+?)%>/g,A=RegExp("^["+x+"]*0+(?=.$)"),M=/($^)/,D=/\bthis\b/,I=/['\n\r\t\u2028\u2029\\]/g,z=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],B=0,L="[object Arguments]",P="[object Array]",q="[object Boolean]",Y="[object Date]",F="[object Function]",U="[object Number]",$="[object Object]",W="[object RegExp]",H="[object String]",V={};V[F]=!1,V[L]=V[P]=V[q]=V[Y]=V[U]=V[$]=V[W]=V[H]=!0;var Q={leading:!1,maxWait:0,trailing:!1},J={configurable:!1,enumerable:!1,value:null,writable:!1},K={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},G={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},X=K[typeof window]&&window||this,Z=K[typeof r]&&r&&!r.nodeType&&r,tn=K[typeof e]&&e&&!e.nodeType&&e,nn=tn&&tn.exports===Z&&Z,en=K[typeof n]&&n;!en||en.global!==en&&en.window!==en||(X=en);var rn=y();"function"==typeof t&&"object"==typeof t.amd&&t.amd?(X._=rn,t(function(){return rn})):Z&&tn?nn?(tn.exports=rn)._=rn:Z._=rn:X._=rn}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(n,e,r){(function(n){/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
!function(n){"use strict";if("function"==typeof bootstrap)bootstrap("promise",n);else if("object"==typeof r&&"object"==typeof e)e.exports=n();else if("function"==typeof t&&t.amd)t(n);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=n}else{if("undefined"==typeof self)throw new Error("This environment was not anticiapted by Q. Please file a bug.");self.Q=n()}}(function(){"use strict";function t(t){return function(){return Q.apply(t,arguments)}}function e(t){return t===Object(t)}function r(t){return"[object StopIteration]"===en(t)||t instanceof $}function o(t,n){if(Y&&n.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf(rn)){for(var e=[],r=n;r;r=r.source)r.stack&&e.unshift(r.stack);e.unshift(t.stack);var o=e.join("\n"+rn+"\n");t.stack=i(o)}}function i(t){for(var n=t.split("\n"),e=[],r=0;r<n.length;++r){var o=n[r];c(o)||u(o)||!o||e.push(o)}return e.join("\n")}function u(t){return-1!==t.indexOf("(module.js:")||-1!==t.indexOf("(node.js:")}function a(t){var n=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(n)return[n[1],Number(n[2])];var e=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(e)return[e[1],Number(e[2])];var r=/.*@(.+):(\d+)$/.exec(t);return r?[r[1],Number(r[2])]:void 0}function c(t){var n=a(t);if(!n)return!1;var e=n[0],r=n[1];return e===U&&r>=W&&cn>=r}function s(){if(Y)try{throw new Error}catch(t){var n=t.stack.split("\n"),e=n[0].indexOf("@")>0?n[1]:n[2],r=a(e);if(!r)return;return U=r[0],r[1]}}function f(t,n,e){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn,t.apply(t,arguments)}}function l(t){return t instanceof v?t:b(t)?C(t):O(t)}function p(){function t(t){n=t,i.source=t,K(e,function(n,e){l.nextTick(function(){t.promiseDispatch.apply(t,e)})},void 0),e=void 0,r=void 0}var n,e=[],r=[],o=Z(p.prototype),i=Z(v.prototype);if(i.promiseDispatch=function(t,o,i){var u=J(arguments);e?(e.push(u),"when"===o&&i[1]&&r.push(i[1])):l.nextTick(function(){n.promiseDispatch.apply(n,u)})},i.valueOf=function(){if(e)return i;var t=m(n);return g(t)&&(n=t),t},i.inspect=function(){return n?n.inspect():{state:"pending"}},l.longStackSupport&&Y)try{throw new Error}catch(u){i.stack=u.stack.substring(u.stack.indexOf("\n")+1)}return o.promise=i,o.resolve=function(e){n||t(l(e))},o.fulfill=function(e){n||t(O(e))},o.reject=function(e){n||t(T(e))},o.notify=function(t){n||K(r,function(n,e){l.nextTick(function(){e(t)})},void 0)},o}function h(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var n=p();try{t(n.resolve,n.reject,n.notify)}catch(e){n.reject(e)}return n.promise}function d(t){return h(function(n,e){for(var r=0,o=t.length;o>r;r++)l(t[r]).then(n,e)})}function v(t,n,e){void 0===n&&(n=function(t){return T(new Error("Promise does not support operation: "+t))}),void 0===e&&(e=function(){return{state:"unknown"}});var r=Z(v.prototype);if(r.promiseDispatch=function(e,o,i){var u;try{u=t[o]?t[o].apply(r,i):n.call(r,o,i)}catch(a){u=T(a)}e&&e(u)},r.inspect=e,e){var o=e();"rejected"===o.state&&(r.exception=o.reason),r.valueOf=function(){var t=e();return"pending"===t.state||"rejected"===t.state?r:t.value}}return r}function y(t,n,e,r){return l(t).then(n,e,r)}function m(t){if(g(t)){var n=t.inspect();if("fulfilled"===n.state)return n.value}return t}function g(t){return t instanceof v}function b(t){return e(t)&&"function"==typeof t.then}function w(t){return g(t)&&"pending"===t.inspect().state}function k(t){return!g(t)||"fulfilled"===t.inspect().state}function _(t){return g(t)&&"rejected"===t.inspect().state}function j(){on.length=0,un.length=0,an||(an=!0)}function x(t,n){an&&(un.push(t),on.push(n&&"undefined"!=typeof n.stack?n.stack:"(no stack) "+n))}function S(t){if(an){var n=G(un,t);-1!==n&&(un.splice(n,1),on.splice(n,1))}}function T(t){var n=v({when:function(n){return n&&S(this),n?n(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return x(n,t),n}function O(t){return v({when:function(){return t},get:function(n){return t[n]},set:function(n,e){t[n]=e},"delete":function(n){delete t[n]},post:function(n,e){return null===n||void 0===n?t.apply(void 0,e):t[n].apply(t,e)},apply:function(n,e){return t.apply(n,e)},keys:function(){return nn(t)}},void 0,function(){return{state:"fulfilled",value:t}})}function C(t){var n=p();return l.nextTick(function(){try{t.then(n.resolve,n.reject,n.notify)}catch(e){n.reject(e)}}),n.promise}function E(t){return v({isDef:function(){}},function(n,e){return I(t,n,e)},function(){return l(t).inspect()})}function R(t,n,e){return l(t).spread(n,e)}function N(t){return function(){function n(t,n){var u;if("undefined"==typeof StopIteration){try{u=e[t](n)}catch(a){return T(a)}return u.done?l(u.value):y(u.value,o,i)}try{u=e[t](n)}catch(a){return r(a)?l(a.value):T(a)}return y(u,o,i)}var e=t.apply(this,arguments),o=n.bind(n,"next"),i=n.bind(n,"throw");return o()}}function A(t){l.done(l.async(t)())}function M(t){throw new $(t)}function D(t){return function(){return R([this,z(arguments)],function(n,e){return t.apply(n,e)})}}function I(t,n,e){return l(t).dispatch(n,e)}function z(t){return y(t,function(t){var n=0,e=p();return K(t,function(r,o,i){var u;g(o)&&"fulfilled"===(u=o.inspect()).state?t[i]=u.value:(++n,y(o,function(r){t[i]=r,0===--n&&e.resolve(t)},e.reject,function(t){e.notify({index:i,value:t})}))},void 0),0===n&&e.resolve(t),e.promise})}function B(t){return y(t,function(t){return t=X(t,l),y(z(X(t,function(t){return y(t,H,H)})),function(){return t})})}function L(t){return l(t).allSettled()}function P(t,n){return l(t).then(void 0,void 0,n)}function q(t,n){return l(t).nodeify(n)}var Y=!1;try{throw new Error}catch(F){Y=!!F.stack}var U,$,W=s(),H=function(){},V=function(){function t(){for(;e.next;){e=e.next;var n=e.task;e.task=void 0;var r=e.domain;r&&(e.domain=void 0,r.enter());try{n()}catch(i){if(u)throw r&&r.exit(),setTimeout(t,0),r&&r.enter(),i;setTimeout(function(){throw i},0)}r&&r.exit()}o=!1}var e={task:void 0,next:null},r=e,o=!1,i=void 0,u=!1;if(V=function(t){r=r.next={task:t,domain:u&&n.domain,next:null},o||(o=!0,i())},"undefined"!=typeof n&&n.nextTick)u=!0,i=function(){n.nextTick(t)};else if("function"==typeof setImmediate)i="undefined"!=typeof window?setImmediate.bind(window,t):function(){setImmediate(t)};else if("undefined"!=typeof MessageChannel){var a=new MessageChannel;a.port1.onmessage=function(){i=c,a.port1.onmessage=t,t()};var c=function(){a.port2.postMessage(0)};i=function(){setTimeout(t,0),c()}}else i=function(){setTimeout(t,0)};return V}(),Q=Function.call,J=t(Array.prototype.slice),K=t(Array.prototype.reduce||function(t,n){var e=0,r=this.length;if(1===arguments.length)for(;;){if(e in this){n=this[e++];break}if(++e>=r)throw new TypeError}for(;r>e;e++)e in this&&(n=t(n,this[e],e));return n}),G=t(Array.prototype.indexOf||function(t){for(var n=0;n<this.length;n++)if(this[n]===t)return n;return-1}),X=t(Array.prototype.map||function(t,n){var e=this,r=[];return K(e,function(o,i,u){r.push(t.call(n,i,u,e))},void 0),r}),Z=Object.create||function(t){function n(){}return n.prototype=t,new n},tn=t(Object.prototype.hasOwnProperty),nn=Object.keys||function(t){var n=[];for(var e in t)tn(t,e)&&n.push(e);return n},en=t(Object.prototype.toString);$="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};var rn="From previous event:";l.resolve=l,l.nextTick=V,l.longStackSupport=!1,"object"==typeof n&&n&&n.env&&n.env.Q_DEBUG&&(l.longStackSupport=!0),l.defer=p,p.prototype.makeNodeResolver=function(){var t=this;return function(n,e){n?t.reject(n):t.resolve(arguments.length>2?J(arguments,1):e)}},l.Promise=h,l.promise=h,h.race=d,h.all=z,h.reject=T,h.resolve=l,l.passByCopy=function(t){return t},v.prototype.passByCopy=function(){return this},l.join=function(t,n){return l(t).join(n)},v.prototype.join=function(t){return l([this,t]).spread(function(t,n){if(t===n)return t;throw new Error("Can't join: not the same: "+t+" "+n)})},l.race=d,v.prototype.race=function(){return this.then(l.race)},l.makePromise=v,v.prototype.toString=function(){return"[object Promise]"},v.prototype.then=function(t,n,e){function r(n){try{return"function"==typeof t?t(n):n}catch(e){return T(e)}}function i(t){if("function"==typeof n){o(t,a);try{return n(t)}catch(e){return T(e)}}return T(t)}function u(t){return"function"==typeof e?e(t):t}var a=this,c=p(),s=!1;return l.nextTick(function(){a.promiseDispatch(function(t){s||(s=!0,c.resolve(r(t)))},"when",[function(t){s||(s=!0,c.resolve(i(t)))}])}),a.promiseDispatch(void 0,"when",[void 0,function(t){var n,e=!1;try{n=u(t)}catch(r){if(e=!0,!l.onerror)throw r;l.onerror(r)}e||c.notify(n)}]),c.promise},l.tap=function(t,n){return l(t).tap(n)},v.prototype.tap=function(t){return t=l(t),this.then(function(n){return t.fcall(n).thenResolve(n)})},l.when=y,v.prototype.thenResolve=function(t){return this.then(function(){return t})},l.thenResolve=function(t,n){return l(t).thenResolve(n)},v.prototype.thenReject=function(t){return this.then(function(){throw t})},l.thenReject=function(t,n){return l(t).thenReject(n)},l.nearer=m,l.isPromise=g,l.isPromiseAlike=b,l.isPending=w,v.prototype.isPending=function(){return"pending"===this.inspect().state},l.isFulfilled=k,v.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},l.isRejected=_,v.prototype.isRejected=function(){return"rejected"===this.inspect().state};var on=[],un=[],an=!0;l.resetUnhandledRejections=j,l.getUnhandledReasons=function(){return on.slice()},l.stopUnhandledRejectionTracking=function(){j(),an=!1},j(),l.reject=T,l.fulfill=O,l.master=E,l.spread=R,v.prototype.spread=function(t,n){return this.all().then(function(n){return t.apply(void 0,n)},n)},l.async=N,l.spawn=A,l["return"]=M,l.promised=D,l.dispatch=I,v.prototype.dispatch=function(t,n){var e=this,r=p();return l.nextTick(function(){e.promiseDispatch(r.resolve,t,n)}),r.promise},l.get=function(t,n){return l(t).dispatch("get",[n])},v.prototype.get=function(t){return this.dispatch("get",[t])},l.set=function(t,n,e){return l(t).dispatch("set",[n,e])},v.prototype.set=function(t,n){return this.dispatch("set",[t,n])},l.del=l["delete"]=function(t,n){return l(t).dispatch("delete",[n])},v.prototype.del=v.prototype["delete"]=function(t){return this.dispatch("delete",[t])},l.mapply=l.post=function(t,n,e){return l(t).dispatch("post",[n,e])},v.prototype.mapply=v.prototype.post=function(t,n){return this.dispatch("post",[t,n])},l.send=l.mcall=l.invoke=function(t,n){return l(t).dispatch("post",[n,J(arguments,2)])},v.prototype.send=v.prototype.mcall=v.prototype.invoke=function(t){return this.dispatch("post",[t,J(arguments,1)])},l.fapply=function(t,n){return l(t).dispatch("apply",[void 0,n])},v.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},l["try"]=l.fcall=function(t){return l(t).dispatch("apply",[void 0,J(arguments,1)])},v.prototype.fcall=function(){return this.dispatch("apply",[void 0,J(arguments)])},l.fbind=function(t){var n=l(t),e=J(arguments,1);return function(){return n.dispatch("apply",[this,e.concat(J(arguments))])}},v.prototype.fbind=function(){var t=this,n=J(arguments);return function(){return t.dispatch("apply",[this,n.concat(J(arguments))])}},l.keys=function(t){return l(t).dispatch("keys",[])},v.prototype.keys=function(){return this.dispatch("keys",[])},l.all=z,v.prototype.all=function(){return z(this)},l.allResolved=f(B,"allResolved","allSettled"),v.prototype.allResolved=function(){return B(this)},l.allSettled=L,v.prototype.allSettled=function(){return this.then(function(t){return z(X(t,function(t){function n(){return t.inspect()}return t=l(t),t.then(n,n)}))})},l.fail=l["catch"]=function(t,n){return l(t).then(void 0,n)},v.prototype.fail=v.prototype["catch"]=function(t){return this.then(void 0,t)},l.progress=P,v.prototype.progress=function(t){return this.then(void 0,void 0,t)},l.fin=l["finally"]=function(t,n){return l(t)["finally"](n)},v.prototype.fin=v.prototype["finally"]=function(t){return t=l(t),this.then(function(n){return t.fcall().then(function(){return n})},function(n){return t.fcall().then(function(){throw n})})},l.done=function(t,n,e,r){return l(t).done(n,e,r)},v.prototype.done=function(t,e,r){var i=function(t){l.nextTick(function(){if(o(t,u),!l.onerror)throw t;l.onerror(t)})},u=t||e||r?this.then(t,e,r):this;"object"==typeof n&&n&&n.domain&&(i=n.domain.bind(i)),u.then(void 0,i)},l.timeout=function(t,n,e){return l(t).timeout(n,e)},v.prototype.timeout=function(t,n){var e=p(),r=setTimeout(function(){n&&"string"!=typeof n||(n=new Error(n||"Timed out after "+t+" ms"),n.code="ETIMEDOUT"),e.reject(n)},t);return this.then(function(t){clearTimeout(r),e.resolve(t)},function(t){clearTimeout(r),e.reject(t)},e.notify),e.promise},l.delay=function(t,n){return void 0===n&&(n=t,t=void 0),l(t).delay(n)},v.prototype.delay=function(t){return this.then(function(n){var e=p();return setTimeout(function(){e.resolve(n)},t),e.promise})},l.nfapply=function(t,n){return l(t).nfapply(n)},v.prototype.nfapply=function(t){var n=p(),e=J(t);return e.push(n.makeNodeResolver()),this.fapply(e).fail(n.reject),n.promise},l.nfcall=function(t){var n=J(arguments,1);return l(t).nfapply(n)},v.prototype.nfcall=function(){var t=J(arguments),n=p();return t.push(n.makeNodeResolver()),this.fapply(t).fail(n.reject),n.promise},l.nfbind=l.denodeify=function(t){var n=J(arguments,1);return function(){var e=n.concat(J(arguments)),r=p();return e.push(r.makeNodeResolver()),l(t).fapply(e).fail(r.reject),r.promise}},v.prototype.nfbind=v.prototype.denodeify=function(){var t=J(arguments);return t.unshift(this),l.denodeify.apply(void 0,t)},l.nbind=function(t,n){var e=J(arguments,2);return function(){function r(){return t.apply(n,arguments)}var o=e.concat(J(arguments)),i=p();return o.push(i.makeNodeResolver()),l(r).fapply(o).fail(i.reject),i.promise}},v.prototype.nbind=function(){var t=J(arguments,0);return t.unshift(this),l.nbind.apply(void 0,t)},l.nmapply=l.npost=function(t,n,e){return l(t).npost(n,e)},v.prototype.nmapply=v.prototype.npost=function(t,n){var e=J(n||[]),r=p();return e.push(r.makeNodeResolver()),this.dispatch("post",[t,e]).fail(r.reject),r.promise},l.nsend=l.nmcall=l.ninvoke=function(t,n){var e=J(arguments,2),r=p();return e.push(r.makeNodeResolver()),l(t).dispatch("post",[n,e]).fail(r.reject),r.promise},v.prototype.nsend=v.prototype.nmcall=v.prototype.ninvoke=function(t){var n=J(arguments,1),e=p();return n.push(e.makeNodeResolver()),this.dispatch("post",[t,n]).fail(e.reject),e.promise},l.nodeify=q,v.prototype.nodeify=function(t){return t?void this.then(function(n){l.nextTick(function(){t(null,n)})},function(n){l.nextTick(function(){t(n)})}):this};var cn=s();return l})}).call(this,n("_process"))},{_process:1}],5:[function(t,n){function e(t,n){var e;return e=n?new o(t,n):new o(t)}var r=function(){return this}(),o=r.WebSocket||r.MozWebSocket;n.exports=o?e:null,o&&(e.prototype=o.prototype)},{}],6:[function(t,n){n.exports={getAccessToken:function(){return"xxwmn93p0h"}}},{}],7:[function(t,n){var e,r,o,i;o=t("./protocol"),r=t("./really-error"),i=t("lodash"),e=function(){function t(){this.tag=0,this._callbacks={}}var n;return t.prototype.handle=function(t){var n,e;if(!(t.tag in this._callbacks))throw new r("A message with this tag: "+t.tag+" doesn't exist");if(e=t.tag,o.isErrorMessage(t))try{this._callbacks[e].error.call(null,t)}catch(i){throw n=i,new r("Error happened when trying to execute your error callback")}else try{this._callbacks[e].success.call(null,t)}catch(i){throw n=i,new r("Error happened when trying to execute your success callback")}try{this._callbacks[e].complete.call(null,t)}catch(i){throw n=i,new r("Error happened when trying to execute your complete callback")}return delete this._callbacks[e]},t.prototype.add=function(t){var e,r,o,u,a;return null==t&&(t={}),o=t.kind,u=t.success,r=t.error,e=t.complete,null==o&&(o="default"),null==u&&(u=i.noop),null==r&&(r=i.noop),null==e&&(e=i.noop),a=n.call(this),this._callbacks[a]={kind:o,success:u,error:r,complete:e},a},n=function(){return this.tag+=1},t}(),n.exports=e},{"./protocol":10,"./really-error":13,lodash:3}],8:[function(t,n){var e,r,o,i,u;u=t("./protocol"),o=t("q"),r=t("./logger"),i=new r,e=function(){function t(t,n){this.interval=null!=t?t:5e3,this.timeout=null!=n?n:5e3,i.debug("Heartbeat: initialize with interval: "+t+" and timeout: "+n)}var n;return t.prototype.start=function(t){return this.websocket=t,n.call(this),i.debug("Heartbeat: started interval: "+this.interval+" timeout: "+this.timeout)},n=function(){var t,e,r,a;return e=u.heartbeatMessage(),r=this.websocket.send(e),a=function(t){return function(e){var r,u;return u=Date.now(),r=.001*(u-e.timestamp),i.debug("Heartbeat: lag "+r+" second(s)"),o.delay(t.interval).then(function(){return i.debug("Heartbeat interval: "+t.interval+" timeout: "+t.timeout),n.call(t)})}}(this),t=function(){return i.debug("Heartbeat: lag exceed"),this.websocket.disconnect()},r.timeout(this.interval+this.timeout).then(a,t)},t}(),n.exports=e},{"./logger":9,"./protocol":10,q:4}],9:[function(t,n){var e,r,o=[].slice;r=t("lodash"),e=function(){function t(){}return t.prototype.debug=function(){var t,n;return t=1<=arguments.length?o.call(arguments,0):[],t.unshift("Really::Debug::"),"undefined"!=typeof console&&null!==console&&null!=(n=console.debug)&&n.apply(console,t),t},t.prototype.info=function(){var t,n;return t=1<=arguments.length?o.call(arguments,0):[],t.unshift("Really::Info::"),"undefined"!=typeof console&&null!==console&&null!=(n=console.log)&&n.apply(console,t),t},t.prototype.warn=function(){var t,n;return t=1<=arguments.length?o.call(arguments,0):[],t.unshift("Really::Warn::"),"undefined"!=typeof console&&null!==console&&null!=(n=console.warn)&&n.apply(console,t),t},t.prototype.error=function(){var t,n,e,i,u,a;return t=1<=arguments.length?o.call(arguments,0):[],u="Really::Error::",r.isObject(t[0])&&(n=t[0].code,i=t[0].message,e=t[0].errorName,u=""+u+e+"::"+n+":: "+i,t.shift()),t.unshift(u),"undefined"!=typeof console&&null!==console&&null!=(a=console.error)&&a.apply(console,t),t},t}(),n.exports=e},{lodash:3}],10:[function(t,n){var e,r,o,i,u=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};i=t("lodash"),o=t("./authenticator"),e=t("./really-error"),r="0",n.exports={clientVersion:r,commands:{init:"init",create:"create",read:"read",get:"get",update:"update","delete":"delete",heartbeat:"poke",subscribe:"subscribe",unsubscribe:"unsubscribe"},initializationMessage:function(t){if(!i.isString(t))throw new e("You should pass accessToken parameter as String");return{kind:"initialization",data:{cmd:this.commands.init,accessToken:t}}},createMessage:function(t,n){var r;if(!i.isString(t))throw new e("You should pass a resource parameter as String");if(!i.isObject(n)&&!i.isUndefined(n))throw new e("You should pass a body parameter as Object");return r={kind:"create",data:{cmd:this.commands.create,r:t}},n&&(r.body=n),r},readMessage:function(t,n){var r,o,u,a,c,s;r=i.omit(n,function(t){return void 0===t}),c={fields:{valid:i.isArray,message:'You should pass Array for "fields" option'},query:{valid:function(t){return i.isObject(t)&&(i.isString(t.filter)||i.isObject(t.values))},message:'You should pass Object for "query" option'},limit:{valid:i.isNumber,message:'You should pass Number for "limit" option'},skip:{valid:i.isNumber,message:'You should pass Number for "skip" option'},sort:{valid:i.isString,message:'You should pass String for "sort" option'},token:{valid:i.isString,message:'You should pass String for "token" option'},includeTotalCount:{valid:i.isBoolean,message:'You should pass Boolean for "includeTotalCount" option'},paginationToken:{valid:i.isString,message:'You should pass String for "paginationToken" option'},subscribe:{valid:i.isBoolean,message:'You should pass Boolean for "subscribe" option'}};for(a in r){if(s=r[a],!(a in c))throw new e('The option "'+a+"\" isn't supported");if(o=c[a],!o.valid(s))throw new e(o.message)}return u={kind:"read",data:{cmd:this.commands.read,r:t}},r&&(u.data.cmdOpts=r),u},getMessage:function(t,n){var r;if(!i.isArray(n))throw new e("You should pass array or nothing for fields option");return r={kind:"get",data:{cmd:this.commands.get,r:t}},n&&(r.data.cmdOpts={fields:n}),r},updateMessage:function(t,n,r){var o,a,c,s,f,l;if(!(i.isArray(r)&&r.length>0))throw new e("You should pass at least one operation");for(c=["set","addNumber","push","addToSet","insertAt","pull","removeAt"],s=0,f=r.length;f>s;s++)if(a=r[s],l=a.op,u.call(c,l)<0)throw new e('"'+a.op+'" operation you passed is not supported');return o={kind:"update",data:{cmd:this.commands.update,rev:n,r:t,body:{ops:r}}}},deleteMessage:function(t){if(!i.isString(t))throw new e("You should pass a resource parameter as String");return{kind:"delete",data:{cmd:this.commands["delete"],r:t}}},subscribeMessage:function(t){var n,r,o,u;if(!i.isPlainObject(t)&&!i.isArray(t))throw new e("subscription(s) should be either Object or Array of Objects");for(i.isArray(t)||(t=[t]),o=0,u=t.length;u>o;o++)if(r=t[o],!i.isNumber(r.rev)||!i.isString(r.res))throw new e("You must pass string resource and number revision for subscription object");return n={kind:"subscribe",data:{cmd:this.commands.subscribe,subscriptions:t}}},unsubscribeMessage:function(t){var n,r,o,u;if(!i.isPlainObject(t)&&!i.isArray(t))throw new e("subscription(s) should be either Object or Array of Objects");for(i.isArray(t)||(t=[t]),o=0,u=t.length;u>o;o++)if(r=t[o],!i.isNumber(r.rev)||!i.isString(r.res))throw new e("You must pass string resource and number revision for subscription object");return n={kind:"unsubscribe",data:{cmd:this.commands.unsubscribe,subscriptions:t}}},heartbeatMessage:function(){var t;return t=Date.now(),{kind:"poke",data:{cmd:this.commands.heartbeat,timestamp:t}}},isErrorMessage:function(t){return i.has(t,"error")}}},{"./authenticator":6,"./really-error":13,lodash:3}],11:[function(t,n){var e;e=t("./really-error"),n.exports={handle:function(t,n){var r,o;switch(null==n&&(n={}),o=n.r,r=n.evt,r){case"updated":case"deleted":return t.object.emit(""+o+":"+r,n);case"created":return t.collection.emit(""+o+":"+r,n);case"kicked":case"revoked":return t.emit(r,n);default:throw new e("Unknown event: "+r)}}}},{"./really-error":13}],12:[function(t,n){var e,r,o,i,u,a;a=t("lodash"),u=t("./protocol"),i=t("./really-error"),e=t("component-emitter"),a=t("lodash"),r=t("q"),o=function(){function t(t){this.channel=t,e(this)}return t.prototype.create=function(t,n){var e,o,c,s,f,l,p;if(null==n&&(n={}),!a.isString(t))throw new i("Can not be initialized without resource");o=new r.defer,p=n.onSuccess,l=n.onError,f=n.onComplete,e=n.body;try{s=u.createMessage(t,e)}catch(h){return c=h,setTimeout(function(){return o.reject(c)},0),o.promise}return this.channel.send(s,{success:p,error:l,complete:f})},t.prototype.read=function(t,n){var e,o,c,s,f,l,p;if(null==n&&(n={}),!a.isString(t))throw new i("Can not be initialized without resource");e=new r.defer,l=n.onSuccess,f=n.onError,s=n.onComplete,p=a.omit(n,["onSuccess","onError","onComplete"]);try{c=u.readMessage(t,p)}catch(h){return o=h,setTimeout(function(){return e.reject(o)},0),e.promise}return this.channel.send(c,{success:l,error:f,complete:s})},t.prototype.onCreate=function(t,n){return this.on(""+t+":created",function(t){return n(t)})},t}(),n.exports=o},{"./protocol":10,"./really-error":13,"component-emitter":2,lodash:3,q:4}],13:[function(t,n){var e,r={}.hasOwnProperty,o=function(t,n){function e(){this.constructor=t}for(var o in n)r.call(n,o)&&(t[o]=n[o]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t};e=function(t){function n(t){this.message=null!=t?t:"Unknown Error","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,n),this.name="ReallyError"}return o(n,t),n}(Error),n.exports=e},{}],14:[function(t,n){var e,r,o,i,u,a;u=t("./protocol"),o=t("./really-error"),e=t("component-emitter"),a=t("lodash"),r=t("q"),i=function(){function t(t){this.channel=t,e(this)}return t.prototype.get=function(t,n){var e,i,c,s,f,l,p;if(!a.isString(t))throw new o("Can not be initialized without resource");e=new r.defer,c=n.fields,p=n.onSuccess,l=n.onError,f=n.onComplete;try{s=u.getMessage(t,c)}catch(h){return i=h,setTimeout(function(){return e.reject(i)},0),e.promise}return this.channel.send(s,{success:p,error:l,complete:f})},t.prototype.update=function(t,n,e){var i,c,s,f,l,p,h;if(!a.isString(t))throw new o("Can not be initialized without resource");if(i=new r.defer,!e)return i.reject(new o("Can't be called without passing arguments")),i.promise;h=e.ops,p=e.onSuccess,l=e.onError,f=e.onComplete;try{s=u.updateMessage(t,h)}catch(d){return c=d,setTimeout(function(){return i.reject(c)},0),i.promise}return this.channel.send(s,{success:p,error:l,complete:f})},t.prototype["delete"]=function(t,n){var e,r,i,c;if(!a.isString(t))throw new o("Can not be initialized without resource");return c=n.onSuccess,i=n.onError,r=n.onComplete,e=u.deleteMessage(t),this.channel.send(e,{success:c,error:i,complete:r})},t.prototype.onUpdate=function(t,n){return this.on(""+t+":updated",function(t){return n(t)})},t.prototype.onDelete=function(t,n){return this.on(""+t+":deleted",function(t){return n(t)})},t}(),n.exports=i},{"./protocol":10,"./really-error":13,"component-emitter":2,lodash:3,q:4}],15:[function(t,n){var e,r,o,i,u,a,c;u=t("./transports/webSocket"),i=t("./really-object"),r=t("./really-collection"),o=t("./really-error"),c=t("lodash"),a={},e=function(){function t(t,n,e){var s;if(!t||!n)throw new o("Can't initialize Really without passing domain and access token");if(!c.isString(t)||!c.isString(n))throw new o("Only <String> values are allowed for domain and access token");return a[t]?(this.object=a[t].object,this.collection=a[t].collection):(s=new u(t,n,e),s.connect(),a[t]={},this.object=a[t].object=new i(s),this.collection=a[t].collection=new r(s),s.on("message",function(t){var n;return n=JSON.parse(t),c.has(n,"tag")?void 0:pushHandler.handle(this,n)})),this}return t}(),n.exports=e},{"./really-collection":12,"./really-error":13,"./really-object":14,"./transports/webSocket":17,lodash:3}],16:[function(t,n){var e;e=function(){function t(t){this.url=t}return t.prototype.connect=function(){return void 0},t.prototype.disconnect=function(){return void 0},t.prototype.send=function(){return void 0},t.prototype.isConnected=function(){return void 0},t.prototype.on=function(){return void 0},t}(),n.exports=e},{}],17:[function(t,n){var e,r,o,i,u,a,c,s,f,l,p,h,d,v={}.hasOwnProperty,y=function(t,n){function e(){this.constructor=t}for(var r in n)v.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t};d=t("lodash"),s=t("../transport"),c=t("../really-error"),f=t("ws"),h=t("../protocol"),r=t("component-emitter"),e=t("../callbacks-buffer"),u=t("../push-handler"),a=t("q"),o=t("../heartbeat"),i=t("../logger"),p=new i,l=function(t){function n(t,n,r){var o;this.domain=t,this.accessToken=n,this.options=null!=r?r:{},this.socket=null,this.callbacksBuffer=new e,this._messagesBuffer=[],this.pushHandler=u,this.initialized=!1,this.url=""+t+"/v"+h.clientVersion+"/socket",o={reconnectionMaxTimeout:3e4,heartbeatTimeout:2e3,heartbeatInterval:5e3,reconnect:!0,onDisconnect:"buffer"},this.options=d.defaults(this.options,o)}var i,s,l;return y(n,t),r(n.prototype),i=function(t){return this.socket.addEventListener("open",function(n){return function(){return n.attempts=0,t.resolve(),l.call(n),n.emit("opened")}}(this)),this.socket.addEventListener("close",function(t){return function(){return t.options.reconnect?(t.emit("reconnecting"),t.reconnect(t.options.reconnectionMaxTimeout)):(t.emit("closed"),t.disconnect())}}(this)),this.socket.addEventListener("error",function(t){return function(){return t.emit("error")}}(this)),this.socket.addEventListener("message",function(t){return function(n){var e;return e=JSON.parse(n.data),d.has(e,"tag")&&t.callbacksBuffer.handle(e),t.emit("message",e)}}(this))},n.prototype.send=function(t,n,e){var r,o,i,u,s,f;return null==n&&(n={}),null==e&&(e=a.defer()),this.isConnected()?(i=t.kind,s=function(t){return"function"==typeof n.success&&n.success(t),e.resolve(t)},o=function(t){return"function"==typeof n.error&&n.error(t),e.reject(t)},r=function(t){return"function"==typeof n.complete?n.complete(t):void 0},t.data.tag=this.callbacksBuffer.add({kind:i,success:s,error:o,complete:r}),this.socket.send(JSON.stringify(t.data)),e.promise):(u=d.isFunction(this.options.onDisconnect)?"custom":this.options.onDisconnect,f=function(r){return function(o){var i,u,a,s,f;null==o&&(o="fail"),s=function(){return e.reject(new c("Connection to the server is not established"))},i=function(){return r._messagesBuffer.push({message:t,options:n,deferred:e})},u=function(){var t;try{return r.options.onDisconnect(r,r._messagesBuffer,c)}catch(n){throw t=n,new c("error invoking custom callback")}},f={fail:s,buffer:i,custom:u};try{return f[o]()}catch(l){if(a=l,a instanceof c)throw a;throw new c("Strategy not found")}}}(this),f(u),e.promise)},l=function(){var t,n,e;return e=function(t){return function(n){var e;return t.initialized=!0,d.flush.call(t),e=new o(t.options.heartbeatInterval,t.options.heartbeatTimeout),e.start(t),t.emit("initialized",n)}}(this),t=function(t){return function(n){return t.initialized=!1,t.emit("initializationError",n)}}(this),n=h.initializationMessage(this.accessToken),this.send(n,{success:e,error:t})},n.prototype.connect=function(t){return null==t&&(t=a.defer()),this.socket=new f(this.url),this.socket.addEventListener("error",d.once(function(){return void 0})),i.call(this,t),t.promise},n.prototype.reconnect=function(t){return this.attempts+=1,this.connect().timeout(t)["catch"](function(){return t=generateTimeout(t),reconnect(t)})},d.flush=function(){return setTimeout(function(t){return function(){var n,e,r,o,i,u,a,c;for(u=t._messagesBuffer,c=[],o=0,i=u.length;i>o;o++)a=u[o],e=a.message,r=a.options,n=a.deferred,c.push(t.send(e,r,n));return c}}(this),0)},n.prototype.isConnected=function(){return this.socket?this.socket.readyState===this.socket.OPEN:!1},n.prototype.isConnecting=function(){return this.socket?this.socket.readyState===this.socket.CONNECTING:!1},s=function(){return this.off()},n.prototype.disconnect=function(){var t;return s.call(this),null!=(t=this.socket)&&t.close(),this.socket=null,this.initialized=!1},n}(s),n.exports=l},{"../callbacks-buffer":7,"../heartbeat":8,"../logger":9,"../protocol":10,"../push-handler":11,"../really-error":13,"../transport":16,"component-emitter":2,lodash:3,q:4,ws:5}]},{},[15])(15)});